<div class="search-wrapper">
  <h1>Pretraga filmova i projekcija</h1>

  <mat-card class="search-card">
    <mat-card-content>
      <div class="filters">
        <mat-form-field>
          <mat-label>Naziv filma</mat-label>
          <input matInput [(ngModel)]="title" (input)="onFilterChange()" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Opis</mat-label>
          <input matInput [(ngModel)]="description" (input)="onFilterChange()" />
        </mat-form-field>

        <mat-form-field>
          <mat-label>Žanr</mat-label>
          <mat-select [(ngModel)]="selectedGenre" (selectionChange)="onFilterChange()">
            <mat-option value="">Svi</mat-option>
            <mat-option *ngFor="let g of genres" [value]="g">{{ g }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Režiser</mat-label>
          <mat-select [(ngModel)]="selectedDirector" (selectionChange)="onFilterChange()">
            <mat-option value="">Svi</mat-option>
            <mat-option *ngFor="let d of directors" [value]="d">{{ d }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Glumci</mat-label>
          <mat-select [(ngModel)]="selectedActors" multiple (selectionChange)="onFilterChange()">
            <mat-option *ngFor="let a of actors" [value]="a">{{ a }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Datum izlaska</mat-label>
          <mat-select [(ngModel)]="selectedReleaseDate" (selectionChange)="onFilterChange()">
            <mat-option value="">Svi</mat-option>
            <mat-option *ngFor="let d of releaseDates" [value]="d">{{ d }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Datum projekcije</mat-label>
          <mat-select [(ngModel)]="selectedProjectionDate" (selectionChange)="onFilterChange()">
            <mat-option value="">Svi</mat-option>
            <mat-option *ngFor="let d of projectionDates" [value]="d">
              {{ d | date:'mediumDate' }}
            </mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Sortiraj po ceni</mat-label>
          <mat-select [(ngModel)]="sortPrice" (selectionChange)="onFilterChange()">
            <mat-option value="">Bez sortiranja</mat-option>
            <mat-option value="asc">Najniža → Najviša</mat-option>
            <mat-option value="desc">Najviša → Najniža</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </mat-card-content>

    <mat-card-actions>
      <button mat-button color="warn" (click)="reset()">Resetuj</button>
    </mat-card-actions>
  </mat-card>

  
  <table mat-table [dataSource]="rows" class="mat-elevation-z8 results-table">
    <ng-container matColumnDef="title">
      <th mat-header-cell *matHeaderCellDef> Film </th>
      <td mat-cell *matCellDef="let r"> {{ r.movie.title }} </td>
    </ng-container>

    <ng-container matColumnDef="genre">
      <th mat-header-cell *matHeaderCellDef> Žanr </th>
      <td mat-cell *matCellDef="let r"> {{ r.movie.genre }} </td>
    </ng-container>

    <ng-container matColumnDef="director">
      <th mat-header-cell *matHeaderCellDef> Režiser </th>
      <td mat-cell *matCellDef="let r"> {{ r.movie.director }} </td>
    </ng-container>

    <ng-container matColumnDef="actors">
      <th mat-header-cell *matHeaderCellDef> Glumci </th>
      <td mat-cell *matCellDef="let r"> {{ r.movie.actors.join(', ') }} </td>
    </ng-container>

    <ng-container matColumnDef="release">
      <th mat-header-cell *matHeaderCellDef> Datum izlaska </th>
      <td mat-cell *matCellDef="let r"> {{ r.movie.releaseDate }} </td>
    </ng-container>

    <ng-container matColumnDef="nearest">
      <th mat-header-cell *matHeaderCellDef> Najbliža projekcija </th>
      <td mat-cell *matCellDef="let r">
        {{ r.nearestProjection ? (r.nearestProjection | date:'short') : '—' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="minPrice">
      <th mat-header-cell *matHeaderCellDef> Min cena </th>
      <td mat-cell *matCellDef="let r">
        {{ r.minPrice !== null ? (r.minPrice + ' RSD') : '—' }}
      </td>
    </ng-container>

    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Akcije </th>
      <td mat-cell *matCellDef="let r">
        <a mat-button color="primary" [routerLink]="['/details', r.movie.id]">Detalji</a>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>
</div>
